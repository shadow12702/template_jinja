{% include 'link.html' %}
<link
	rel="stylesheet"
	href="{{ url_for('static', filename='admin/css/patches/edit_patches.css') }}" />
<div class="row">
	<!-- Main Content -->
	<div
		class="col-12 content-area p-0"
		style="flex-grow: 1; transition: width 0.3s ease-in-out; overflow: hidden">
		<div class="container">
			<div
				class="page-header d-flex justify-content-between align-items-center">
				<div>
					<h1>Chỉnh sửa cấu hình</h1>
					<p>Cập nhật thông tin cấu hình</p>
				</div>
				<a
					href="{{ url_for('admin_route.config_route.config_management') }}"
					class="btn btn-outline-secondary back-btn">
					<i class="fas fa-arrow-left"></i> Quay lại danh sách cấu hình
				</a>
			</div>

			<!-- Hiển thị thông báo lỗi nếu có -->
			{% if error %}
			<div class="alert alert-danger alert-dismissible fade show" role="alert">
				<i class="fas fa-exclamation-triangle me-2"></i> {{ error }}
				<button
					type="button"
					class="btn-close"
					data-bs-dismiss="alert"
					aria-label="Close"></button>
			</div>
			{% endif %}

			<!-- Edit Config Form -->
			<div class="form-container">
				{% if config %}
				<form
					id="editConfigForm"
					method="POST"
					action="{{ url_for('admin_route.config_route.edit_config', type_=config.type, key=config.key) }}">
					<div class="card">
						<div class="card-body">
							<h5 class="card-title mb-4">Thông tin cấu hình</h5>

							<div class="row">
								<div class="col-md-6">
									<div class="form-group">
										<label for="type"
											>Loại cấu hình <span class="text-danger">*</span></label
										>
										<div class="input-group">
											<span class="input-group-text"
												><i class="fas fa-tag"></i
											></span>
											<input
												type="text"
												class="form-control"
												id="type"
												name="type"
												value="{{ config.type }}"
												readonly />
										</div>
										<small class="form-text text-muted"
											>Loại cấu hình không thể thay đổi</small
										>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-group">
										<label for="key"
											>Khóa cấu hình <span class="text-danger">*</span></label
										>
										<div class="input-group">
											<span class="input-group-text"
												><i class="fas fa-key"></i
											></span>
											<input
												type="text"
												class="form-control"
												id="key"
												name="key"
												value="{{ config.key }}"
												readonly />
										</div>
										<small class="form-text text-muted"
											>Khóa cấu hình không thể thay đổi</small
										>
									</div>
								</div>
							</div>

							<div class="row mt-3">
								<div class="col-md-12">
									<div class="form-group">
										<label for="value"
											>Giá trị <span class="text-danger">*</span></label
										>
										<div class="input-group">
											<span class="input-group-text"
												><i class="fas fa-edit"></i
											></span>
											<input
												type="text"
												class="form-control"
												id="value"
												name="value"
												value="{{ config.value }}"
												required />
										</div>
										<small class="form-text text-muted"
											>Giá trị cấu hình có thể thay đổi</small
										>
									</div>
								</div>
							</div>

							<div class="row mt-3">
								<div class="col-md-6">
									<div class="form-group">
										<label for="is_locked">Trạng thái khóa</label>
										<div class="form-check form-switch mt-2">
											<input class="form-check-input" type="checkbox"
											id="is_locked" name="is_locked" value="1" {% if
											config.is_locked == 1 %}checked{% endif %}>
											<label class="form-check-label" for="is_locked"
												>Đã khóa</label
											>
										</div>
										<small class="form-text text-muted"
											>Cấu hình đã khóa sẽ không thể thay đổi bởi người dùng
											thông thường</small
										>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-group">
										<label>Thông tin thời gian</label>
										<div class="mt-2">
											<small class="text-muted d-block"
												>Tạo lúc: {{ config.created_on.strftime('%d/%m/%Y
												%H:%M:%S') }}</small
											>
											<small class="text-muted d-block"
												>Cập nhật cuối: {{
												config.last_changed.strftime('%d/%m/%Y %H:%M:%S')
												}}</small
											>
										</div>
									</div>
								</div>
							</div>

							<div class="form-actions mt-4">
								<div class="text-end">
									<a
										href="{{ url_for('admin_route.config_route.config_management') }}"
										class="btn btn-outline-secondary me-2"
										>Hủy bỏ</a
									>
									<button type="submit" class="btn btn-primary">
										<i class="fas fa-save me-1"></i> Lưu thay đổi
									</button>
								</div>
							</div>
						</div>
					</div>
				</form>
				{% else %}
				<div class="alert alert-danger">
					Cấu hình không tồn tại trong hệ thống.
				</div>
				{% endif %}
			</div>
		</div>
	</div>
</div>

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
	// Đảm bảo rằng checkbox is_locked gửi giá trị 0 khi không được chọn
	document
		.getElementById("editConfigForm")
		.addEventListener("submit", function () {
			const isLockedCheckbox = document.getElementById("is_locked");
			if (!isLockedCheckbox.checked) {
				// Tạo input ẩn để gửi giá trị 0 khi checkbox không được chọn
				const hiddenInput = document.createElement("input");
				hiddenInput.type = "hidden";
				hiddenInput.name = "is_locked";
				hiddenInput.value = "0";
				this.appendChild(hiddenInput);
			}
		});
</script>
{% endblock %}
